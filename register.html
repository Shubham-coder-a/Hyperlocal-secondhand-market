<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register â€” Hyperiocal Market</title>
    <meta name="description"
        content="Create your Hyperiocal account to buy and sell secondhand items near your campus." />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        :root {
            --g900: #064e3b;
            --g700: #047857;
            --g500: #10b981;
            --g400: #34d399;
            --g100: #d1fae5;
            --g50: #ecfdf5;
            --bg: #f0fdf4;
            --surface: #fff;
            --muted: #6b7280;
            --text: #111827;
            --border: #d1fae5;
            --err: #ef4444;
            --err-bg: #fef2f2
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 20px
        }

        /* NAVBAR */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--g900);
            z-index: 100;
            padding: 13px 24px;
            display: flex;
            align-items: center;
            gap: 10px
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 9px;
            color: var(--g400);
            font-size: 1.15rem;
            font-weight: 800;
            text-decoration: none
        }

        .brand-icon {
            width: 30px;
            height: 30px;
            background: var(--g500);
            border-radius: 8px;
            display: grid;
            place-items: center;
            color: #fff;
            font-size: .85rem
        }

        /* CARD */
        .card {
            background: var(--surface);
            border-radius: 20px;
            padding: 36px 32px;
            width: 100%;
            max-width: 460px;
            box-shadow: 0 8px 40px rgba(6, 78, 59, .1);
            border: 1px solid var(--g100);
            margin-top: 60px
        }

        .card-header {
            text-align: center;
            margin-bottom: 28px
        }

        .card-icon {
            width: 60px;
            height: 60px;
            background: var(--g50);
            border-radius: 16px;
            display: grid;
            place-items: center;
            font-size: 1.8rem;
            margin: 0 auto 14px
        }

        .card-header h1 {
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 5px
        }

        .card-header p {
            color: var(--muted);
            font-size: .875rem
        }

        /* FORM */
        .form-group {
            margin-bottom: 16px
        }

        .form-label {
            display: block;
            font-size: .82rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text)
        }

        .input-wrap {
            position: relative
        }

        .input-wrap i {
            position: absolute;
            left: 13px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--muted);
            font-size: .9rem;
            pointer-events: none
        }

        .form-input {
            width: 100%;
            padding: 11px 13px 11px 38px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg);
            color: var(--text);
            font-size: .92rem;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: border .2s
        }

        .form-input:focus {
            border-color: var(--g500)
        }

        .form-input.err {
            border-color: var(--err);
            background: var(--err-bg)
        }

        .form-input::placeholder {
            color: var(--muted)
        }

        .field-err {
            color: var(--err);
            font-size: .75rem;
            margin-top: 5px;
            display: none
        }

        .field-err.show {
            display: block
        }

        /* ALERT */
        .alert {
            padding: 11px 14px;
            border-radius: 10px;
            font-size: .83rem;
            font-weight: 500;
            margin-bottom: 16px;
            display: none;
            align-items: center;
            gap: 8px
        }

        .alert.show {
            display: flex
        }

        .alert-err {
            background: var(--err-bg);
            color: var(--err);
            border: 1px solid rgba(239, 68, 68, .25)
        }

        .alert-ok {
            background: var(--g50);
            color: var(--g700);
            border: 1px solid var(--g100)
        }

        /* STRENGTH BAR */
        .strength-bar {
            display: flex;
            gap: 4px;
            margin-top: 6px
        }

        .strength-seg {
            height: 3px;
            flex: 1;
            border-radius: 99px;
            background: var(--border);
            transition: background .3s
        }

        .strength-label {
            font-size: .72rem;
            color: var(--muted);
            margin-top: 4px
        }

        /* CHECKBOX */
        .check-row {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 20px;
            font-size: .82rem;
            color: var(--muted);
            line-height: 1.5
        }

        .check-row input {
            margin-top: 2px;
            accent-color: var(--g500)
        }

        .check-row a {
            color: var(--g700);
            font-weight: 600
        }

        /* SUBMIT */
        .btn-submit {
            width: 100%;
            padding: 13px;
            background: linear-gradient(135deg, var(--g500), var(--g700));
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: .95rem;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all .25s;
            box-shadow: 0 4px 14px rgba(16, 185, 129, .3)
        }

        .btn-submit:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, .4)
        }

        .btn-submit:disabled {
            opacity: .7;
            cursor: not-allowed;
            transform: none
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, .4);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin .6s linear infinite;
            display: none
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        .spinner.show {
            display: block
        }

        /* FOOTER LINK */
        .auth-link {
            text-align: center;
            margin-top: 20px;
            font-size: .85rem;
            color: var(--muted)
        }

        .auth-link a {
            color: var(--g700);
            font-weight: 700;
            text-decoration: none
        }

        .auth-link a:hover {
            text-decoration: underline
        }

        /* DIVIDER */
        .divider {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
            color: var(--muted);
            font-size: .78rem
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border)
        }
    </style>
</head>

<body>

    <nav class="navbar">
        <a href="index.html" class="brand">
            <div class="brand-icon"><i class="fa-solid fa-leaf"></i></div>
            Hyperiocal
        </a>
    </nav>

    <div class="card">
        <div class="card-header">
            <div class="card-icon">ðŸŒ¿</div>
            <h1>Create Account</h1>
            <p>Join the campus secondhand marketplace</p>
        </div>

        <!-- Error / Success Alerts -->
        <div class="alert alert-err" id="alertErr"><i class="fa-solid fa-circle-exclamation"></i><span
                id="alertErrMsg">Something went wrong.</span></div>
        <div class="alert alert-ok" id="alertOk"><i class="fa-solid fa-circle-check"></i><span
                id="alertOkMsg">Success!</span></div>

        <form id="registerForm" novalidate>
            <!-- Name -->
            <div class="form-group">
                <label class="form-label" for="fullName">Full Name</label>
                <div class="input-wrap">
                    <i class="fa-solid fa-user"></i>
                    <input id="fullName" type="text" class="form-input" placeholder="Shubham Desai" required />
                </div>
                <div class="field-err" id="nameErr">Please enter your full name.</div>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label class="form-label" for="email">Email Address</label>
                <div class="input-wrap">
                    <i class="fa-solid fa-envelope"></i>
                    <input id="email" type="email" class="form-input" placeholder="you@college.edu" required />
                </div>
                <div class="field-err" id="emailErr">Please enter a valid email.</div>
            </div>

            <!-- Phone -->
            <div class="form-group">
                <label class="form-label" for="phone">Mobile Number</label>
                <div class="input-wrap">
                    <i class="fa-solid fa-phone"></i>
                    <input id="phone" type="tel" class="form-input" placeholder="98765 43210" maxlength="10" required />
                </div>
                <div class="field-err" id="phoneErr">Enter a valid 10-digit number.</div>
            </div>

            <!-- Password -->
            <div class="form-group">
                <label class="form-label" for="password">Password</label>
                <div class="input-wrap">
                    <i class="fa-solid fa-lock"></i>
                    <input id="password" type="password" class="form-input" placeholder="Min. 8 characters"
                        oninput="checkStrength(this.value)" />
                </div>
                <div class="strength-bar" id="strengthBar">
                    <div class="strength-seg" id="s1"></div>
                    <div class="strength-seg" id="s2"></div>
                    <div class="strength-seg" id="s3"></div>
                    <div class="strength-seg" id="s4"></div>
                </div>
                <div class="strength-label" id="strengthLbl"></div>
                <div class="field-err" id="passErr">Password must be at least 8 characters.</div>
            </div>

            <!-- Confirm Password -->
            <div class="form-group">
                <label class="form-label" for="confirmPass">Confirm Password</label>
                <div class="input-wrap">
                    <i class="fa-solid fa-lock"></i>
                    <input id="confirmPass" type="password" class="form-input" placeholder="Repeat password" />
                </div>
                <div class="field-err" id="confirmErr">Passwords do not match.</div>
            </div>

            <!-- Terms -->
            <div class="check-row">
                <input type="checkbox" id="terms" required />
                <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy
                        Policy</a></label>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn">
                <div class="spinner" id="spinner"></div>
                <span id="btnTxt"><i class="fa-solid fa-user-plus"></i> Create Account</span>
            </button>
        </form>

        <div class="auth-link">Already have an account? <a href="login.html">Sign In</a></div>
    </div>

    <script type="module">
        import { auth, db } from "./firebase-config.js";
        import { createUserWithEmailAndPassword, updateProfile }
            from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { doc, setDoc, serverTimestamp }
            from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // â”€â”€â”€ STRENGTH METER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.checkStrength = (v) => {
            const segs = [document.getElementById("s1"), document.getElementById("s2"),
            document.getElementById("s3"), document.getElementById("s4")];
            const lbl = document.getElementById("strengthLbl");
            let score = 0;
            if (v.length >= 8) score++;
            if (/[A-Z]/.test(v)) score++;
            if (/[0-9]/.test(v)) score++;
            if (/[^A-Za-z0-9]/.test(v)) score++;
            const colors = ["#ef4444", "#f59e0b", "#10b981", "#047857"];
            const labels = ["Weak", "Fair", "Good", "Strong"];
            segs.forEach((s, i) => { s.style.background = i < score ? colors[score - 1] : "var(--border)"; });
            lbl.textContent = score > 0 ? labels[score - 1] : "";
            lbl.style.color = score > 0 ? colors[score - 1] : "var(--muted)";
        };

        // â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function showErr(msg) { showAlert("alertErr", "alertErrMsg", msg); }
        function showOk(msg) { showAlert("alertOk", "alertOkMsg", msg); }
        function showAlert(id, tid, msg) {
            document.getElementById("alertErr").classList.remove("show");
            document.getElementById("alertOk").classList.remove("show");
            document.getElementById(tid).textContent = msg;
            document.getElementById(id).classList.add("show");
        }
        function setLoading(on) {
            document.getElementById("spinner").classList.toggle("show", on);
            document.getElementById("btnTxt").style.display = on ? "none" : "flex";
            document.getElementById("submitBtn").disabled = on;
        }
        function fieldErr(id, msg, show) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.classList.toggle("show", show);
        }
        function clearErrors() {
            ["nameErr", "emailErr", "phoneErr", "passErr", "confirmErr"]
                .forEach(id => document.getElementById(id).classList.remove("show"));
            ["fullName", "email", "phone", "password", "confirmPass"]
                .forEach(id => document.getElementById(id).classList.remove("err"));
        }

        // â”€â”€â”€ SUBMIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        document.getElementById("registerForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            clearErrors();

            const name = document.getElementById("fullName").value.trim();
            const email = document.getElementById("email").value.trim();
            const phone = document.getElementById("phone").value.trim();
            const pass = document.getElementById("password").value;
            const conf = document.getElementById("confirmPass").value;
            const terms = document.getElementById("terms").checked;

            let valid = true;
            if (!name) { fieldErr("nameErr", "Please enter your full name.", true); document.getElementById("fullName").classList.add("err"); valid = false; }
            if (!email || !/\S+@\S+\.\S+/.test(email)) { fieldErr("emailErr", "Please enter a valid email.", true); document.getElementById("email").classList.add("err"); valid = false; }
            if (!phone || phone.length !== 10 || !/^\d+$/.test(phone)) { fieldErr("phoneErr", "Enter a valid 10-digit number.", true); document.getElementById("phone").classList.add("err"); valid = false; }
            if (pass.length < 8) { fieldErr("passErr", "Password must be at least 8 characters.", true); document.getElementById("password").classList.add("err"); valid = false; }
            if (pass !== conf) { fieldErr("confirmErr", "Passwords do not match.", true); document.getElementById("confirmPass").classList.add("err"); valid = false; }
            if (!terms) { showErr("Please accept the Terms of Service."); valid = false; }
            if (!valid) return;

            setLoading(true);
            try {
                // 1. Create Firebase Auth user
                const cred = await createUserWithEmailAndPassword(auth, email, pass);
                // 2. Set display name
                await updateProfile(cred.user, { displayName: name });
                // 3. Save profile to Firestore
                await setDoc(doc(db, "users", cred.user.uid), {
                    name, email, phone,
                    createdAt: serverTimestamp()
                });
                showOk("Account created! Redirectingâ€¦");
                setTimeout(() => { window.location.href = "index.html"; }, 1200);
            } catch (err) {
                const msgs = {
                    "auth/email-already-in-use": "This email is already registered. Try logging in.",
                    "auth/invalid-email": "Please enter a valid email address.",
                    "auth/weak-password": "Choose a stronger password (min. 6 characters).",
                    "auth/network-request-failed": "Network error. Check your connection and retry."
                };
                showErr(msgs[err.code] || "Registration failed: " + err.message);
                setLoading(false);
            }
        });
    </script>
</body>

</html>